<section class="transactions">
  <div class="header">
    <h2>ğŸ’° Movimientos Financieros</h2>
    <button class="btn-primary" routerLink="/transactions/form">+ Nuevo Movimiento</button>
  </div>

  <!-- Filtros -->
  <div class="filters-card">
    <h3>ğŸ” Filtros</h3>
    <div class="filters-grid">
      <div class="filter-group">
        <label for="tipo">Tipo</label>
        <select id="tipo" [(ngModel)]="filtros.tipo" (change)="aplicarFiltros()">
          <option value="">Todos</option>
          <option value="Ingreso">Ingresos</option>
          <option value="Gasto">Gastos</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="categoria">CategorÃ­a</label>
        <select id="categoria" [(ngModel)]="filtros.categoria" (change)="aplicarFiltros()">
          <option value="">Todas</option>
          <option *ngFor="let cat of categorias" [value]="cat.nombre">{{ cat.nombre }}</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="fechaDesde">Desde</label>
        <input 
          type="date" 
          id="fechaDesde" 
          [(ngModel)]="filtros.fechaDesde"
          (change)="aplicarFiltros()"
        />
      </div>

      <div class="filter-group">
        <label for="fechaHasta">Hasta</label>
        <input 
          type="date" 
          id="fechaHasta" 
          [(ngModel)]="filtros.fechaHasta"
          (change)="aplicarFiltros()"
        />
      </div>

      <div class="filter-actions">
        <button class="btn-secondary" (click)="limpiarFiltros()">ğŸ”„ Limpiar</button>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading">
    <p>â³ Cargando transacciones...</p>
  </div>

  <!-- Sin resultados -->
  <div *ngIf="!loading && transacciones.length === 0" class="no-data">
    <p>ğŸ“­ No se encontraron transacciones</p>
    <button class="btn-primary" routerLink="/transactions/form">Crear la primera</button>
  </div>

  <!-- Tabla de transacciones -->
  <div *ngIf="!loading && transacciones.length > 0" class="table-container">
    <table>
      <thead>
        <tr>
          <th>Tipo</th>
          <th>CategorÃ­a</th>
          <th>Monto</th>
          <th>Fecha</th>
          <th>DescripciÃ³n</th>
          <th *ngIf="isAdmin">Usuario</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let m of transacciones">
          <td>
            <span class="badge" [class]="getTipoClass(m.tipo)">
              {{ m.tipo === 'Ingreso' ? 'ğŸ“ˆ' : 'ğŸ“‰' }} {{ m.tipo }}
            </span>
          </td>
          <td>{{ m.categoria }}</td>
          <td class="monto" [class]="getTipoClass(m.tipo)">
            {{ m.tipo === 'Ingreso' ? '+' : '-' }}{{ m.monto | moneda }}
          </td>
          <td>{{ m.fecha | fecha }}</td>
          <td>{{ m.descripcion || '-' }}</td>
          <td *ngIf="isAdmin">Usuario #{{ m.usuarioId }}</td>
          <td class="actions">
            <button 
              *ngIf="canEdit(m)"
              class="btn-edit" 
              [routerLink]="['/transactions/form', m.id]"
              title="Editar"
            >
              âœï¸
            </button>
            <button 
              *ngIf="canEdit(m)"
              class="btn-delete" 
              (click)="onDelete(m.id)"
              title="Eliminar"
            >
              ğŸ—‘ï¸
            </button>
            <span *ngIf="!canEdit(m)" class="no-actions">-</span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Resumen -->
  <div *ngIf="!loading && transacciones.length > 0" class="summary">
    <p>ğŸ“Š Total de transacciones: <strong>{{ transacciones.length }}</strong></p>
  </div>
</section>
