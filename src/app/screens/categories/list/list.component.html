<section class="categories">
  <!-- Alert Message -->
  @if (showAlert) {
    <div class="alert" [class.alert-success]="alertType === 'success'" 
         [class.alert-warning]="alertType === 'warning'"
         [class.alert-error]="alertType === 'error'">
      {{ alertMessage }}
      <button class="alert-close" (click)="showAlert = false">&times;</button>
    </div>
  }

  <div class="header">
    <h2>üìÅ Categor√≠as</h2>
    <button class="btn btn-primary" routerLink="/categories/form">
      ‚ûï Nueva Categor√≠a
    </button>
  </div>

  @if (loading) {
    <div class="loading">
      <p>Cargando categor√≠as...</p>
    </div>
  } @else if (categorias.length === 0) {
    <div class="no-data">
      <p>No hay categor√≠as registradas</p>
      <button class="btn btn-primary" routerLink="/categories/form">
        Crear primera categor√≠a
      </button>
    </div>
  } @else {
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Tipo</th>
            <th>Color</th>
            <th>Estado</th>
            @if (isAdmin) {
              <th>Usuario</th>
            }
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          @for (categoria of categorias; track categoria.id) {
            <tr [class.inactive]="!categoria.estado">
              <td>{{ categoria.nombre }}</td>
              <td>
                <span class="badge" [class.badge-ingreso]="categoria.tipo === 'Ingreso'"
                      [class.badge-gasto]="categoria.tipo === 'Gasto'">
                  {{ categoria.tipo }}
                </span>
              </td>
              <td>
                <div class="color-indicator" [style.background-color]="categoria.color">
                  {{ categoria.color }}
                </div>
              </td>
              <td>
                <span class="status" [class.status-active]="categoria.estado"
                      [class.status-inactive]="!categoria.estado">
                  {{ categoria.estado ? 'Activo' : 'Inactivo' }}
                </span>
              </td>
              @if (isAdmin) {
                <td>
                  <span class="user-badge">
                    üë§ {{ getNombreUsuario(categoria.usuarioId) }}
                  </span>
                </td>
              }
              <td class="actions">
                <button class="btn btn-edit" 
                        [routerLink]="['/categories/form', categoria.id]"
                        title="Editar">
                  ‚úèÔ∏è
                </button>
                @if (categoria.estado) {
                  <button class="btn btn-delete" 
                          (click)="onDeleteClick(categoria)"
                          title="Eliminar">
                    üóëÔ∏è
                  </button>
                } @else {
                  <button class="btn btn-activate" 
                          (click)="onActivateClick(categoria)"
                          title="Activar">
                    ‚úÖ
                  </button>
                }
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }
</section>

<!-- Modal de confirmaci√≥n -->
<app-confirm-delete-category-modal
  [isOpen]="isModalOpen"
  [categoryName]="selectedCategory?.nombre || ''"
  [hasTransactions]="hasTransactions"
  [transactionCount]="transactionCount"
  (confirm)="onConfirmDelete()"
  (cancel)="onCancelDelete()">
</app-confirm-delete-category-modal>
